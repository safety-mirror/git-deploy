#!/bin/bash

USERNAME=$1
PUBLIC_KEY=$2

./test-authorized-keys $PUBLIC_KEY
if [ $? ]; then
    echo "ssh key not valid"
    exit 1
fi

if [ ! -d "~/.ssh/authorized_keys.d/" ]; then
    mkdir ~/.ssh/authorized_keys.d/
fi

echo 'command="USER=${USERNAME} /usr/bin/git-shell" ${PUBLIC_KEY}\n' \
    >> ~/.ssh/authorized_keys.d/$USERNAME.pub
