#!/bin/bash

USERNAME=$1
PUBKEY="$2 $3 $4"

git-shell-commands/ssh-check-key $PUBKEY
if [ $? -eq 1 ]; then
    echo "ssh key not valid"
    exit $USERNAME
fi

mkdir -p .ssh/authorized_keys.d/

touch .ssh/authorized_keys.d/${USERNAME}.pub

echo "command=\"ssh-check-key bananas\" ${PUBKEY}" \
    >> .ssh/authorized_keys.d/${USERNAME}.pub

#Turns out authorized_keys.d is just a thing people do apparently
cat .ssh/authorized_keys.d/* > .ssh/authorized_keys
